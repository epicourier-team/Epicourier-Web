# v1.3.0 Smart Cart Integration - Development Plan

**Document Version**: 1.0  
**Created**: November 29, 2025  
**Status**: ğŸ“ Planning  
**Estimated Duration**: 4-5 Sprints (8-10 weeks)

---

## ğŸ“‹ Overview

v1.3.0 implements a comprehensive **Smart Cart** system with three core features:
1. **Shopping List** - Auto-generate shopping lists from meal calendar
2. **Inventory Management** - Track pantry/fridge items with expiration dates
3. **AI Recipe Suggestions** - Recommend recipes based on available inventory (Python backend)

---

## ğŸ—ï¸ Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            v1.3.0 Smart Cart System                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Shopping List  â”‚    â”‚    Inventory    â”‚    â”‚  AI Recipe Suggestions   â”‚ â”‚
â”‚  â”‚                 â”‚    â”‚   Management    â”‚    â”‚    (Python Backend)      â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ â€¢ List CRUD     â”‚    â”‚ â€¢ Item CRUD     â”‚    â”‚ â€¢ Ingredient matching    â”‚ â”‚
â”‚  â”‚ â€¢ Auto-generate â”‚â—€â”€â”€â–¶â”‚ â€¢ Expiration    â”‚â”€â”€â”€â–¶â”‚ â€¢ Coverage scoring       â”‚ â”‚
â”‚  â”‚ â€¢ Aggregation   â”‚    â”‚   tracking      â”‚    â”‚ â€¢ Expiration priority    â”‚ â”‚
â”‚  â”‚ â€¢ Export        â”‚    â”‚ â€¢ Location tags â”‚    â”‚ â€¢ Gemini preferences     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                      â”‚                          â”‚               â”‚
â”‚           â–¼                      â–¼                          â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                         Supabase PostgreSQL                              â”‚â”‚
â”‚  â”‚  shopping_lists â”‚ shopping_list_items â”‚ user_inventory â”‚ Ingredient     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Epic Structure

### Epic Overview

| Epic # | Title                          | Priority | Est. Effort | Dependencies |
|--------|--------------------------------|----------|-------------|--------------|
| E1     | Database Schema & Types        | P0       | 1 Sprint    | None         |
| E2     | Shopping List System           | P1       | 1.5 Sprints | E1           |
| E3     | Inventory Management           | P1       | 1.5 Sprints | E1           |
| E4     | AI Recipe Recommendations      | P1       | 1 Sprint    | E3           |
| E5     | Integration & Polish           | P2       | 1 Sprint    | E2, E3, E4   |

---

## ğŸ“¦ Epic 1: Database Schema & Types (Foundation)

**Epic ID**: `epic/v1.3.0-database-foundation`  
**Priority**: P0 (Blocker for all other Epics)  
**Estimated Effort**: 1 Sprint (2 weeks)

### Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Epic 1: Database Foundation                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  #75 shopping_lists schema â”€â”€â”                                   â”‚
â”‚           â”‚                  â”‚                                   â”‚
â”‚           â–¼                  â–¼                                   â”‚
â”‚  #76 shopping_list_items â”€â”€â”€â–¶ #78 TypeScript Types               â”‚
â”‚           â–²                  â–²                                   â”‚
â”‚           â”‚                  â”‚                                   â”‚
â”‚  #77 user_inventory â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Sub-Issues

#### Issue #75: `feat(database): shopping_lists table schema`

**Type**: Database  
**Priority**: P0  
**Blocked By**: None  
**Blocks**: #76, #78

**Description**:
Create the `shopping_lists` table to store shopping list metadata for users.

**Schema**:
```sql
CREATE TABLE shopping_lists (
  id SERIAL PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  name TEXT NOT NULL DEFAULT 'Shopping List',
  date_range_start DATE,
  date_range_end DATE,
  status TEXT NOT NULL DEFAULT 'draft' CHECK (status IN ('draft', 'active', 'completed')),
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_shopping_lists_user_id ON shopping_lists(user_id);
CREATE INDEX idx_shopping_lists_status ON shopping_lists(status);

-- RLS Policies
ALTER TABLE shopping_lists ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own shopping lists"
  ON shopping_lists FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can create own shopping lists"
  ON shopping_lists FOR INSERT
  WITH CHECK (auth.uid() = user_id);

CREATE POLICY "Users can update own shopping lists"
  ON shopping_lists FOR UPDATE
  USING (auth.uid() = user_id);

CREATE POLICY "Users can delete own shopping lists"
  ON shopping_lists FOR DELETE
  USING (auth.uid() = user_id);
```

**Acceptance Criteria**:
- [ ] Table created with all columns
- [ ] Indexes added for performance
- [ ] RLS policies enforce user isolation
- [ ] Migration file created in `supabase/migrations/`

---

#### Issue #76: `feat(database): shopping_list_items table schema`

**Type**: Database  
**Priority**: P0  
**Blocked By**: #75  
**Blocks**: #78

**Description**:
Create the `shopping_list_items` table to store individual items in shopping lists.

**Schema**:
```sql
CREATE TABLE shopping_list_items (
  id SERIAL PRIMARY KEY,
  list_id INTEGER NOT NULL REFERENCES shopping_lists(id) ON DELETE CASCADE,
  ingredient_id INTEGER NOT NULL REFERENCES "Ingredient"(id),
  quantity NUMERIC NOT NULL DEFAULT 1,
  unit TEXT,
  is_checked BOOLEAN NOT NULL DEFAULT FALSE,
  added_from_recipe_id INTEGER REFERENCES "Recipe"(id) ON DELETE SET NULL,
  notes TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_shopping_list_items_list_id ON shopping_list_items(list_id);
CREATE INDEX idx_shopping_list_items_ingredient_id ON shopping_list_items(ingredient_id);
CREATE INDEX idx_shopping_list_items_is_checked ON shopping_list_items(is_checked);

-- RLS (inherit from parent shopping_lists via join)
ALTER TABLE shopping_list_items ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can manage items in own lists"
  ON shopping_list_items FOR ALL
  USING (
    EXISTS (
      SELECT 1 FROM shopping_lists sl
      WHERE sl.id = shopping_list_items.list_id
      AND sl.user_id = auth.uid()
    )
  );
```

**Acceptance Criteria**:
- [ ] Table created with all columns
- [ ] Foreign keys to shopping_lists, Ingredient, Recipe
- [ ] RLS policy inherits from parent list
- [ ] Cascade delete when list is deleted

---

#### Issue #77: `feat(database): user_inventory table schema`

**Type**: Database  
**Priority**: P0  
**Blocked By**: None  
**Blocks**: #78

**Description**:
Create the `user_inventory` table to track user's pantry/fridge items.

**Schema**:
```sql
CREATE TABLE user_inventory (
  id SERIAL PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  ingredient_id INTEGER NOT NULL REFERENCES "Ingredient"(id),
  quantity NUMERIC NOT NULL DEFAULT 1,
  unit TEXT,
  expiration_date DATE,
  location TEXT NOT NULL DEFAULT 'pantry' CHECK (location IN ('pantry', 'fridge', 'freezer')),
  notes TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_user_inventory_user_id ON user_inventory(user_id);
CREATE INDEX idx_user_inventory_ingredient_id ON user_inventory(ingredient_id);
CREATE INDEX idx_user_inventory_expiration ON user_inventory(expiration_date);
CREATE INDEX idx_user_inventory_location ON user_inventory(location);

-- Unique constraint: one entry per user+ingredient+location
CREATE UNIQUE INDEX idx_user_inventory_unique 
  ON user_inventory(user_id, ingredient_id, location);

-- RLS Policies
ALTER TABLE user_inventory ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own inventory"
  ON user_inventory FOR SELECT
  USING (auth.uid() = user_id);

CREATE POLICY "Users can manage own inventory"
  ON user_inventory FOR ALL
  USING (auth.uid() = user_id);
```

**Acceptance Criteria**:
- [ ] Table created with all columns
- [ ] Unique constraint prevents duplicate entries
- [ ] Index on expiration_date for "expiring soon" queries
- [ ] Location enum supports pantry/fridge/freezer

---

#### Issue #78: `chore(types): TypeScript types for shopping/inventory`

**Type**: Frontend  
**Priority**: P1  
**Blocked By**: #75, #76, #77  
**Blocks**: All API/Frontend issues

**Description**:
Add TypeScript types for shopping lists and inventory to `src/types/data.ts`.

**Types**:
```typescript
// Shopping List Types
export type ShoppingListStatus = 'draft' | 'active' | 'completed';

export interface ShoppingList {
  id: number;
  user_id: string;
  name: string;
  date_range_start: string | null;
  date_range_end: string | null;
  status: ShoppingListStatus;
  created_at: string;
  updated_at: string;
}

export interface ShoppingListItem {
  id: number;
  list_id: number;
  ingredient_id: number;
  quantity: number;
  unit: string | null;
  is_checked: boolean;
  added_from_recipe_id: number | null;
  notes: string | null;
  created_at: string;
  // Joined data
  ingredient?: Ingredient;
  recipe?: Recipe;
}

export interface ShoppingListWithItems extends ShoppingList {
  items: ShoppingListItem[];
}

// Inventory Types
export type InventoryLocation = 'pantry' | 'fridge' | 'freezer';

export interface InventoryItem {
  id: number;
  user_id: string;
  ingredient_id: number;
  quantity: number;
  unit: string | null;
  expiration_date: string | null;
  location: InventoryLocation;
  notes: string | null;
  created_at: string;
  updated_at: string;
  // Joined data
  ingredient?: Ingredient;
}

// API Request/Response Types
export interface GenerateShoppingListRequest {
  name?: string;
  date_range_start: string;
  date_range_end: string;
}

export interface AddInventoryItemRequest {
  ingredient_id: number;
  quantity: number;
  unit?: string;
  expiration_date?: string;
  location: InventoryLocation;
  notes?: string;
}

// AI Recommendation Types (for Python API)
export interface InventoryRecommendRequest {
  inventory: Array<{
    ingredient_id: number;
    quantity: number;
    expiration_date?: string;
  }>;
  preferences?: string;
  num_recipes?: number;
}

export interface InventoryRecommendResponse {
  recipes: Array<{
    recipe: Recipe;
    coverage_score: number;
    uses_expiring: boolean;
    reasoning: string;
  }>;
}
```

**Acceptance Criteria**:
- [ ] All types added to `src/types/data.ts`
- [ ] Types match database schema exactly
- [ ] Request/Response types for all API endpoints
- [ ] Update `src/types/supabase.ts` if using generated types

---

## ğŸ“¦ Epic 2: Shopping List System

**Epic ID**: `epic/v1.3.0-shopping-list`  
**Priority**: P1  
**Estimated Effort**: 1.5 Sprints (3 weeks)  
**Blocked By**: Epic 1

### Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Epic 2: Shopping List System                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Epic 1 Complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚           â”‚                                        â”‚              â”‚
â”‚           â–¼                                        â–¼              â”‚
â”‚  #79 Shopping List CRUD API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ #82 Shopping List Page   â”‚
â”‚           â”‚                                        â”‚              â”‚
â”‚           â–¼                                        â–¼              â”‚
â”‚  #80 Auto-generate from Calendar â”€â”€â”€â”€â”€â–¶ #83 Item Interactions    â”‚
â”‚           â”‚                                                       â”‚
â”‚           â–¼                                                       â”‚
â”‚  #81 Ingredient Aggregation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ #84 Export Feature       â”‚
â”‚                                                                   â”‚
â”‚  #85 Shopping List API Tests â—€â”€â”€â”€â”€â”€â”€â”€â”€ All APIs complete         â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Sub-Issues

#### Issue #79: `feat(api): Shopping list CRUD endpoints`

**Type**: Next.js API  
**Priority**: P1  
**Blocked By**: #78  
**Blocks**: #80, #82

**Description**:
Create CRUD API endpoints for shopping lists and items.

**Endpoints**:
```
GET    /api/shopping-lists              - List all user's shopping lists
POST   /api/shopping-lists              - Create new shopping list
GET    /api/shopping-lists/[id]         - Get single list with items
PUT    /api/shopping-lists/[id]         - Update list (name, status)
DELETE /api/shopping-lists/[id]         - Delete list and all items

POST   /api/shopping-lists/[id]/items   - Add item to list
PUT    /api/shopping-lists/[id]/items/[itemId] - Update item (quantity, checked)
DELETE /api/shopping-lists/[id]/items/[itemId] - Remove item from list
```

**File Structure**:
```
src/app/api/shopping-lists/
â”œâ”€â”€ route.ts                    # GET (list), POST (create)
â””â”€â”€ [id]/
    â”œâ”€â”€ route.ts                # GET, PUT, DELETE
    â””â”€â”€ items/
        â”œâ”€â”€ route.ts            # POST (add item)
        â””â”€â”€ [itemId]/
            â””â”€â”€ route.ts        # PUT, DELETE
```

**Acceptance Criteria**:
- [ ] All endpoints return proper HTTP status codes
- [ ] Items include joined Ingredient data
- [ ] Proper error handling for invalid IDs
- [ ] RLS ensures user isolation

---

#### Issue #80: `feat(api): Auto-generate shopping list from calendar`

**Type**: Next.js API  
**Priority**: P1  
**Blocked By**: #79  
**Blocks**: #82

**Description**:
Create endpoint to auto-generate a shopping list from meal calendar date range.

**Endpoint**:
```
POST /api/shopping-lists/generate
Request Body: {
  name?: string,
  date_range_start: "2025-12-01",
  date_range_end: "2025-12-07"
}
Response: {
  shopping_list: ShoppingListWithItems
}
```

**Algorithm**:
1. Query Calendar for all meals in date range
2. Get Recipe IDs from calendar entries
3. Query `Recipe-Ingredient_Map` for all ingredients
4. Aggregate ingredients (combine duplicates, sum quantities)
5. Create shopping list with aggregated items

**Acceptance Criteria**:
- [ ] Generates list from calendar date range
- [ ] Links items to source recipes (`added_from_recipe_id`)
- [ ] Handles empty date ranges gracefully
- [ ] Returns complete list with joined data

---

#### Issue #81: `feat(api): Smart ingredient aggregation algorithm`

**Type**: Next.js API (utility)  
**Priority**: P1  
**Blocked By**: #80  
**Blocks**: #84

**Description**:
Implement smart aggregation when combining ingredients from multiple recipes.

**Algorithm**:
```typescript
// Example: Two recipes need "chicken breast"
// Recipe A: 500g chicken breast
// Recipe B: 300g chicken breast
// Result: 800g chicken breast (combined)

function aggregateIngredients(
  items: Array<{ ingredient_id: number; quantity: number; unit: string }>
): AggregatedItem[] {
  // 1. Group by ingredient_id
  // 2. Sum quantities (with unit conversion if needed)
  // 3. Return deduplicated list
}
```

**Unit Conversion Rules**:
- Same unit â†’ Sum directly
- Different units â†’ Convert to base unit (g, ml) then sum
- Incompatible units â†’ Keep separate entries

**Acceptance Criteria**:
- [ ] Combines same ingredients from different recipes
- [ ] Handles unit conversions (g â†” kg, ml â†” L)
- [ ] Preserves recipe source references
- [ ] Utility function is testable independently

---

#### Issue #82: `feat(frontend): Shopping List Page`

**Type**: Frontend  
**Priority**: P1  
**Blocked By**: #79, #80  
**Blocks**: #83

**Description**:
Create the shopping list management page at `/dashboard/shopping`.

**UI Components**:
```
/dashboard/shopping
â”œâ”€â”€ ShoppingListSelector     - Dropdown/tabs for multiple lists
â”œâ”€â”€ GenerateFromCalendar     - Date range picker + generate button
â”œâ”€â”€ ShoppingListView
â”‚   â”œâ”€â”€ ListHeader           - Name, status, date range
â”‚   â”œâ”€â”€ ItemList             - Scrollable list of items
â”‚   â”‚   â””â”€â”€ ShoppingItem     - Checkbox, name, quantity, source recipe
â”‚   â””â”€â”€ ListActions          - Export, delete, mark complete
â””â”€â”€ AddItemDialog            - Search ingredient, set quantity
```

**Wireframe**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Shopping Lists              [+ New List] [Generate from ğŸ“…] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“‹ Week of Dec 1-7                    Status: Active â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  â˜ Chicken Breast          800g    (from 2 recipes)  â”‚   â”‚
â”‚  â”‚  â˜‘ Olive Oil               150ml   (from 3 recipes)  â”‚   â”‚
â”‚  â”‚  â˜ Garlic                  6 cloves                  â”‚   â”‚
â”‚  â”‚  â˜ Tomatoes                4 whole                   â”‚   â”‚
â”‚  â”‚  â˜ Rice                    500g                      â”‚   â”‚
â”‚  â”‚  ...                                                 â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  [ğŸ–¨ï¸ Export] [âœ… Mark Complete] [ğŸ—‘ï¸ Delete]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Acceptance Criteria**:
- [ ] View all shopping lists
- [ ] Generate list from calendar with date picker
- [ ] Display items with ingredient details
- [ ] Show which recipes items came from
- [ ] Responsive design for mobile

---

#### Issue #83: `feat(frontend): Shopping list item interactions`

**Type**: Frontend  
**Priority**: P1  
**Blocked By**: #82  
**Blocks**: None

**Description**:
Implement interactive features for shopping list items.

**Features**:
- Checkbox to mark items as purchased (persists to DB)
- Edit quantity inline
- Delete item with confirmation
- Drag-and-drop reorder (optional P2)
- Swipe to delete on mobile

**Acceptance Criteria**:
- [ ] Checkbox updates `is_checked` in database
- [ ] Optimistic UI updates for responsiveness
- [ ] Checked items move to bottom of list
- [ ] Visual feedback for completed items (strikethrough)

---

#### Issue #84: `feat(frontend): Shopping list export`

**Type**: Frontend  
**Priority**: P2  
**Blocked By**: #81  
**Blocks**: None

**Description**:
Add export functionality for shopping lists.

**Export Formats**:
- **Print-friendly**: HTML page optimized for printing
- **Plain text**: Copyable text list
- **Share link**: (Future) Generate shareable URL

**Acceptance Criteria**:
- [ ] Print button opens print dialog
- [ ] Text export copies to clipboard
- [ ] Export excludes checked items (option)
- [ ] Groups by category/location (optional)

---

#### Issue #85: `test: Shopping list API unit tests`

**Type**: Testing  
**Priority**: P1  
**Blocked By**: #79, #80, #81  
**Blocks**: None

**Description**:
Write comprehensive unit tests for shopping list APIs.

**Test Coverage**:
```
shopping-lists/route.ts
â”œâ”€â”€ GET - list all shopping lists
â”œâ”€â”€ POST - create new shopping list
â””â”€â”€ Error handling

shopping-lists/[id]/route.ts
â”œâ”€â”€ GET - get single list with items
â”œâ”€â”€ PUT - update list
â”œâ”€â”€ DELETE - delete list
â””â”€â”€ 404 for non-existent list

shopping-lists/generate/route.ts
â”œâ”€â”€ Generate from valid date range
â”œâ”€â”€ Empty date range returns empty list
â”œâ”€â”€ Ingredient aggregation
â””â”€â”€ Error handling
```

**Target Coverage**: 85%+

---

## ğŸ“¦ Epic 3: Inventory Management

**Epic ID**: `epic/v1.3.0-inventory`  
**Priority**: P1  
**Estimated Effort**: 1.5 Sprints (3 weeks)  
**Blocked By**: Epic 1

### Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Epic 3: Inventory Management                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Epic 1 Complete                                                 â”‚
â”‚           â”‚                                                      â”‚
â”‚           â–¼                                                      â”‚
â”‚  #86 Inventory CRUD API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ #88 Inventory Page       â”‚
â”‚           â”‚                                        â”‚             â”‚
â”‚           â–¼                                        â–¼             â”‚
â”‚  #87 Expiration Queries â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ #89 Expiration Warnings  â”‚
â”‚                                                                   â”‚
â”‚  #90 Inventory API Tests â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ All APIs complete         â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Sub-Issues

#### Issue #86: `feat(api): Inventory CRUD endpoints`

**Type**: Next.js API  
**Priority**: P1  
**Blocked By**: #78  
**Blocks**: #87, #88

**Description**:
Create CRUD API endpoints for user inventory.

**Endpoints**:
```
GET    /api/inventory              - List all inventory items (with filters)
POST   /api/inventory              - Add item to inventory
GET    /api/inventory/[id]         - Get single item
PUT    /api/inventory/[id]         - Update item (quantity, expiration, location)
DELETE /api/inventory/[id]         - Remove item from inventory

GET    /api/inventory/search       - Search by ingredient name
```

**Query Parameters for GET /api/inventory**:
```
?location=fridge              - Filter by location
?expiring_within=7            - Items expiring within N days
?ingredient_id=123            - Filter by ingredient
```

**File Structure**:
```
src/app/api/inventory/
â”œâ”€â”€ route.ts                  # GET (list), POST (add)
â”œâ”€â”€ search/
â”‚   â””â”€â”€ route.ts              # GET (search by name)
â””â”€â”€ [id]/
    â””â”€â”€ route.ts              # GET, PUT, DELETE
```

**Acceptance Criteria**:
- [ ] All CRUD operations working
- [ ] Location filter (pantry/fridge/freezer)
- [ ] Expiration date filter
- [ ] Includes joined Ingredient data
- [ ] Upsert behavior for same ingredient+location

---

#### Issue #87: `feat(api): Expiring ingredients query`

**Type**: Next.js API  
**Priority**: P1  
**Blocked By**: #86  
**Blocks**: #89, E4

**Description**:
Add specialized query for items expiring soon.

**Endpoint**:
```
GET /api/inventory/expiring?days=7

Response: {
  expiring_soon: [
    {
      ...InventoryItem,
      days_until_expiry: 3,
      urgency: "warning" | "critical"
    }
  ],
  expired: [...]
}
```

**Urgency Levels**:
- `critical`: Expires within 2 days
- `warning`: Expires within 7 days
- `normal`: More than 7 days

**Acceptance Criteria**:
- [ ] Returns items sorted by expiration date
- [ ] Includes days until expiry calculation
- [ ] Separates expired items
- [ ] Efficient database query (index used)

---

#### Issue #88: `feat(frontend): Inventory Management Page`

**Type**: Frontend  
**Priority**: P1  
**Blocked By**: #86  
**Blocks**: #89

**Description**:
Create the inventory management page at `/dashboard/inventory`.

**UI Components**:
```
/dashboard/inventory
â”œâ”€â”€ LocationTabs             - Pantry | Fridge | Freezer | All
â”œâ”€â”€ InventoryGrid
â”‚   â””â”€â”€ InventoryCard        - Ingredient, quantity, expiration badge
â”œâ”€â”€ AddItemDialog            - Search ingredient, set details
â”œâ”€â”€ ExpiringBanner           - Alert for soon-to-expire items
â””â”€â”€ SearchBar                - Quick search across inventory
```

**Wireframe**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  My Inventory                                   [+ Add Item] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš ï¸ 3 items expiring soon                     [View All â†’]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [All] [ğŸ¥« Pantry] [â„ï¸ Fridge] [ğŸ§Š Freezer]                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ” Search ingredients...                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ğŸ¥› Milk    â”‚ â”‚ ğŸ¥š Eggs    â”‚ â”‚ ğŸ§€ Cheese  â”‚               â”‚
â”‚  â”‚ 1L        â”‚ â”‚ 12 whole   â”‚ â”‚ 200g       â”‚               â”‚
â”‚  â”‚ âš ï¸ 2 days â”‚ â”‚ 5 days    â”‚ â”‚ 14 days   â”‚               â”‚
â”‚  â”‚ [Edit]    â”‚ â”‚ [Edit]    â”‚ â”‚ [Edit]    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚ ğŸš Rice   â”‚ â”‚ ğŸ«’ Olive   â”‚                              â”‚
â”‚  â”‚ 2kg       â”‚ â”‚ Oil 500ml  â”‚                              â”‚
â”‚  â”‚ No expiry â”‚ â”‚ No expiry  â”‚                              â”‚
â”‚  â”‚ [Edit]    â”‚ â”‚ [Edit]    â”‚                              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Acceptance Criteria**:
- [ ] Grid/list view of inventory items
- [ ] Filter by location (tabs)
- [ ] Search by ingredient name
- [ ] Add new item with autocomplete
- [ ] Edit/delete items
- [ ] Responsive card layout

---

#### Issue #89: `feat(frontend): Inventory expiration warnings`

**Type**: Frontend  
**Priority**: P2  
**Blocked By**: #87, #88  
**Blocks**: None

**Description**:
Add visual warnings for expiring inventory items.

**Features**:
- Banner showing count of expiring items
- Color-coded badges on items (red/yellow/green)
- Dashboard widget showing "Use Soon" items
- Optional: Push notification for expiring items

**Acceptance Criteria**:
- [ ] Expiring banner on inventory page
- [ ] Color badges: red (<2 days), yellow (2-7 days)
- [ ] Widget on `/dashboard` home page
- [ ] Links to inventory page for management

---

#### Issue #90: `test: Inventory API unit tests`

**Type**: Testing  
**Priority**: P1  
**Blocked By**: #86, #87  
**Blocks**: None

**Description**:
Write unit tests for inventory APIs.

**Test Coverage**:
```
inventory/route.ts
â”œâ”€â”€ GET - list all inventory
â”œâ”€â”€ GET - filter by location
â”œâ”€â”€ GET - filter by expiration
â”œâ”€â”€ POST - add new item
â”œâ”€â”€ POST - upsert existing item
â””â”€â”€ Error handling

inventory/[id]/route.ts
â”œâ”€â”€ GET - get single item
â”œâ”€â”€ PUT - update item
â”œâ”€â”€ DELETE - remove item
â””â”€â”€ 404 handling

inventory/expiring/route.ts
â”œâ”€â”€ Returns items sorted by expiration
â”œâ”€â”€ Calculates days_until_expiry
â”œâ”€â”€ Separates expired items
```

**Target Coverage**: 85%+

---

## ğŸ“¦ Epic 4: AI Recipe Recommendations

**Epic ID**: `epic/v1.3.0-ai-inventory`  
**Priority**: P1  
**Estimated Effort**: 1 Sprint (2 weeks)  
**Blocked By**: Epic 3 (needs inventory data)

### Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Epic 4: AI Recipe Recommendations                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Epic 3 Complete (#86, #87)                                      â”‚
â”‚           â”‚                                                      â”‚
â”‚           â–¼                                                      â”‚
â”‚  #91 Python: Inventory Recommend API                             â”‚
â”‚           â”‚                                                      â”‚
â”‚           â–¼                                                      â”‚
â”‚  #92 Python: Expiration Priority Scoring                         â”‚
â”‚           â”‚                                                      â”‚
â”‚           â–¼                                                      â”‚
â”‚  #93 Frontend: Suggest Recipes Button â”€â”€â”€â”€â”€â–¶ #94 Recommendation  â”‚
â”‚                                                   Modal          â”‚
â”‚                                                                  â”‚
â”‚  #95 Python API Tests â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ All APIs complete     â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Sub-Issues

#### Issue #91: `feat(python): AI recipe suggestions from inventory`

**Type**: Python Backend  
**Priority**: P1  
**Blocked By**: #86 (inventory API)  
**Blocks**: #92, #93

**Description**:
Create new FastAPI endpoint for inventory-based recipe recommendations.

**Endpoint**:
```python
# backend/api/index.py

@app.post("/inventory-recommend")
async def inventory_recommend(request: InventoryRecommendRequest):
    """
    Recommend recipes based on user's available inventory.
    
    Algorithm:
    1. Get recipe-ingredient mappings from database
    2. Calculate coverage score for each recipe
    3. Apply expiration urgency bonus
    4. Optional: Filter by preferences via Gemini
    5. Use KMeans for diversity (reuse from recommender.py)
    6. Return top N recipes with reasoning
    """
```

**Request/Response**:
```python
class InventoryRecommendRequest(BaseModel):
    inventory: List[InventoryItem]
    preferences: Optional[str] = None
    num_recipes: int = 5

class InventoryItem(BaseModel):
    ingredient_id: int
    quantity: float
    expiration_date: Optional[str] = None

class RecipeRecommendation(BaseModel):
    recipe_id: int
    recipe_name: str
    coverage_score: float      # 0-1: % of ingredients available
    missing_ingredients: List[str]
    uses_expiring: List[str]   # Ingredients expiring soon
    reasoning: str

@app.post("/inventory-recommend")
async def inventory_recommend(request: InventoryRecommendRequest) -> dict:
    return {
        "recipes": List[RecipeRecommendation],
        "summary": "Found 5 recipes using 80% of your inventory..."
    }
```

**Acceptance Criteria**:
- [ ] Endpoint accessible at `/inventory-recommend`
- [ ] Calculates ingredient coverage correctly
- [ ] Returns recipes sorted by coverage
- [ ] Includes missing ingredients list
- [ ] Reuses existing embedding/clustering code

---

#### Issue #92: `feat(python): Expiration priority in suggestions`

**Type**: Python Backend  
**Priority**: P2  
**Blocked By**: #91  
**Blocks**: None

**Description**:
Enhance recommendation algorithm to prioritize expiring ingredients.

**Algorithm Enhancement**:
```python
def calculate_recipe_score(recipe, inventory):
    base_coverage = calculate_coverage(recipe, inventory)
    
    # Bonus for using expiring ingredients
    expiring_bonus = 0
    for ing in recipe.ingredients:
        inv_item = find_in_inventory(ing, inventory)
        if inv_item and inv_item.expiration_date:
            days_left = (inv_item.expiration_date - today).days
            if days_left <= 2:
                expiring_bonus += 0.3  # High bonus for critical
            elif days_left <= 7:
                expiring_bonus += 0.1  # Small bonus for warning
    
    return base_coverage + min(expiring_bonus, 0.5)  # Cap bonus at 0.5
```

**Acceptance Criteria**:
- [ ] Expiring items increase recipe score
- [ ] Critical items (â‰¤2 days) weighted higher
- [ ] `uses_expiring` field in response shows which
- [ ] Reasoning explains "Uses your expiring chicken"

---

#### Issue #93: `feat(frontend): Suggest recipes from inventory button`

**Type**: Frontend  
**Priority**: P1  
**Blocked By**: #91  
**Blocks**: #94

**Description**:
Add "Suggest Recipes" button to inventory page.

**Location**: `/dashboard/inventory`

**Behavior**:
1. Click "ğŸ³ Suggest Recipes" button
2. Gather current inventory items
3. Call Python API `/inventory-recommend`
4. Open modal with recommendations

**Acceptance Criteria**:
- [ ] Button visible on inventory page
- [ ] Loading state while fetching
- [ ] Passes all inventory items to API
- [ ] Error handling for API failures

---

#### Issue #94: `feat(frontend): Recipe recommendation modal`

**Type**: Frontend  
**Priority**: P1  
**Blocked By**: #93  
**Blocks**: None

**Description**:
Create modal to display AI recipe recommendations.

**UI Design**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ³ Recipes You Can Make                              [X]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Based on your inventory, here are some suggestions:        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. Chicken Stir Fry                    â˜… 95% match   â”‚   â”‚
â”‚  â”‚    âœ… Uses expiring: chicken breast (2 days)         â”‚   â”‚
â”‚  â”‚    âŒ Missing: soy sauce, sesame oil                 â”‚   â”‚
â”‚  â”‚    [View Recipe] [Add Missing to Shopping List]      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 2. Vegetable Fried Rice                â˜… 88% match   â”‚   â”‚
â”‚  â”‚    âœ… Uses expiring: eggs (3 days)                   â”‚   â”‚
â”‚  â”‚    âŒ Missing: green onions                          â”‚   â”‚
â”‚  â”‚    [View Recipe] [Add Missing to Shopping List]      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                              â”‚
â”‚  [Load More]                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Acceptance Criteria**:
- [ ] Display recipe cards with coverage %
- [ ] Show which expiring items are used
- [ ] List missing ingredients
- [ ] Link to recipe detail page
- [ ] "Add missing to shopping list" action

---

#### Issue #95: `test(python): Inventory recommendation tests`

**Type**: Testing  
**Priority**: P1  
**Blocked By**: #91, #92  
**Blocks**: None

**Description**:
Write pytest tests for inventory recommendation API.

**Test Cases**:
```python
# backend/tests/test_inventory_recommend.py

def test_recommend_with_full_coverage():
    """Recipe with all ingredients available scores highest"""

def test_recommend_prioritizes_expiring():
    """Recipes using expiring ingredients rank higher"""

def test_recommend_returns_missing_ingredients():
    """Response includes list of missing ingredients"""

def test_recommend_empty_inventory():
    """Empty inventory returns helpful message"""

def test_recommend_with_preferences():
    """Preferences filter affects results"""

def test_recommend_diversity():
    """Results include diverse recipe types"""
```

**Target Coverage**: 85%+

---

## ğŸ“¦ Epic 5: Integration & Polish

**Epic ID**: `epic/v1.3.0-integration`  
**Priority**: P2  
**Estimated Effort**: 1 Sprint (2 weeks)  
**Blocked By**: Epics 2, 3, 4

### Dependency Graph

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Epic 5: Integration & Polish                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Epics 2, 3, 4 Complete                                          â”‚
â”‚           â”‚                                                      â”‚
â”‚           â–¼                                                      â”‚
â”‚  #96 Add to Shopping List from Recipe Page                       â”‚
â”‚           â”‚                                                      â”‚
â”‚           â–¼                                                      â”‚
â”‚  #97 Calendar Integration (Quick Add to Cart)                    â”‚
â”‚           â”‚                                                      â”‚
â”‚           â–¼                                                      â”‚
â”‚  #98 Dashboard Widgets (Shopping & Inventory)                    â”‚
â”‚           â”‚                                                      â”‚
â”‚           â–¼                                                      â”‚
â”‚  #99 Sidebar Navigation Updates                                  â”‚
â”‚           â”‚                                                      â”‚
â”‚           â–¼                                                      â”‚
â”‚  #100 Integration Tests                                          â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Sub-Issues

#### Issue #96: `feat(frontend): Add to shopping list from recipe page`

**Type**: Frontend  
**Priority**: P2  
**Blocked By**: #79 (Shopping CRUD)  
**Blocks**: None

**Description**:
Add "Add Ingredients to Shopping List" button on recipe detail page.

**Location**: `/dashboard/recipes/[id]`

**Behavior**:
1. Click "ğŸ›’ Add to Shopping List"
2. Select which shopping list (or create new)
3. Confirm ingredients to add (with quantities)
4. Add items to selected list

**Acceptance Criteria**:
- [ ] Button on recipe detail page
- [ ] Modal to select/create list
- [ ] Can adjust quantities before adding
- [ ] Success toast notification

---

#### Issue #97: `feat(frontend): Calendar quick-add to cart`

**Type**: Frontend  
**Priority**: P2  
**Blocked By**: #80 (Generate from calendar)  
**Blocks**: None

**Description**:
Add shortcut to generate shopping list from calendar view.

**Location**: `/dashboard/calendar`

**Behavior**:
1. Select date range on calendar
2. Right-click or button: "Generate Shopping List"
3. Creates list with all ingredients for selected meals

**Acceptance Criteria**:
- [ ] Context menu or button on calendar
- [ ] Uses existing generate API
- [ ] Success redirects to shopping list

---

#### Issue #98: `feat(frontend): Dashboard widgets for shopping/inventory`

**Type**: Frontend  
**Priority**: P2  
**Blocked By**: #82, #88  
**Blocks**: None

**Description**:
Add summary widgets to `/dashboard` home page.

**Widgets**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ›’ Shopping List     â”‚  â”‚ ğŸ“¦ Inventory         â”‚
â”‚ 12 items remaining   â”‚  â”‚ 23 items tracked     â”‚
â”‚ 3 checked            â”‚  â”‚ âš ï¸ 3 expiring soon   â”‚
â”‚ [View List â†’]        â”‚  â”‚ [View Inventory â†’]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Acceptance Criteria**:
- [ ] Shopping list summary widget
- [ ] Inventory status widget
- [ ] Expiring items warning
- [ ] Links to respective pages

---

#### Issue #99: `chore(frontend): Sidebar navigation updates`

**Type**: Frontend  
**Priority**: P2  
**Blocked By**: None  
**Blocks**: None

**Description**:
Add Shopping List and Inventory links to sidebar navigation.

**New Navigation Items**:
```
Dashboard
â”œâ”€â”€ ğŸ  Home
â”œâ”€â”€ ğŸ“… Calendar
â”œâ”€â”€ ğŸ½ï¸ Recipes
â”œâ”€â”€ ğŸ¤– Recommender
â”œâ”€â”€ ğŸ“Š Nutrients
â”œâ”€â”€ ğŸ† Achievements
â”œâ”€â”€ ğŸ”¥ Challenges
â”œâ”€â”€ ğŸ›’ Shopping List    â† NEW
â”œâ”€â”€ ğŸ“¦ Inventory        â† NEW
â””â”€â”€ âš™ï¸ Settings
```

**Acceptance Criteria**:
- [ ] Links added to sidebar
- [ ] Active state styling
- [ ] Mobile menu updated
- [ ] Icons match design system

---

#### Issue #100: `test: v1.3.0 integration tests`

**Type**: Testing  
**Priority**: P1  
**Blocked By**: All other issues  
**Blocks**: Release

**Description**:
Write integration tests covering cross-feature workflows.

**Test Scenarios**:
```
1. Generate shopping list from calendar
   - Create calendar entries
   - Generate list
   - Verify items aggregated correctly

2. Inventory to recommendations flow
   - Add items to inventory
   - Get recommendations
   - Verify coverage scores

3. Recipe to shopping list flow
   - View recipe
   - Add to shopping list
   - Verify items added

4. Shopping list lifecycle
   - Create list
   - Check items
   - Complete list
```

**Target Coverage**: 80%+ integration paths

---

## ğŸ“… Sprint Plan

### Sprint 1: Foundation (Week 1-2)
**Focus**: Database + Types (Epic 1)

| Issue | Title | Assignee | Status |
|-------|-------|----------|--------|
| #75 | shopping_lists schema | - | ğŸ“ |
| #76 | shopping_list_items schema | - | ğŸ“ |
| #77 | user_inventory schema | - | ğŸ“ |
| #78 | TypeScript types | - | ğŸ“ |

**Exit Criteria**: All tables created, RLS working, types complete

---

### Sprint 2: Shopping List Core (Week 3-4)
**Focus**: Shopping List CRUD + UI (Epic 2 - Part 1)

| Issue | Title | Assignee | Status |
|-------|-------|----------|--------|
| #79 | Shopping list CRUD API | - | ğŸ“ |
| #80 | Auto-generate from calendar | - | ğŸ“ |
| #82 | Shopping List Page | - | ğŸ“ |

**Exit Criteria**: Can create, view, generate shopping lists

---

### Sprint 3: Shopping List Complete + Inventory Start (Week 5-6)
**Focus**: Shopping List polish + Inventory API (Epic 2 - Part 2, Epic 3 - Part 1)

| Issue | Title | Assignee | Status |
|-------|-------|----------|--------|
| #81 | Ingredient aggregation | - | ğŸ“ |
| #83 | Shopping item interactions | - | ğŸ“ |
| #84 | Export feature | - | ğŸ“ |
| #85 | Shopping list tests | - | ğŸ“ |
| #86 | Inventory CRUD API | - | ğŸ“ |

**Exit Criteria**: Shopping list feature complete, inventory API ready

---

### Sprint 4: Inventory Complete + AI Start (Week 7-8)
**Focus**: Inventory UI + Python AI (Epic 3 - Part 2, Epic 4)

| Issue | Title | Assignee | Status |
|-------|-------|----------|--------|
| #87 | Expiration queries | - | ğŸ“ |
| #88 | Inventory Page | - | ğŸ“ |
| #89 | Expiration warnings | - | ğŸ“ |
| #90 | Inventory tests | - | ğŸ“ |
| #91 | Python inventory recommend | - | ğŸ“ |
| #92 | Expiration priority scoring | - | ğŸ“ |

**Exit Criteria**: Inventory feature complete, AI API working

---

### Sprint 5: AI UI + Integration (Week 9-10)
**Focus**: AI Frontend + Polish (Epic 4 - Part 2, Epic 5)

| Issue | Title | Assignee | Status |
|-------|-------|----------|--------|
| #93 | Suggest recipes button | - | ğŸ“ |
| #94 | Recommendation modal | - | ğŸ“ |
| #95 | Python API tests | - | ğŸ“ |
| #96 | Add to list from recipe | - | ğŸ“ |
| #97 | Calendar quick-add | - | ğŸ“ |
| #98 | Dashboard widgets | - | ğŸ“ |
| #99 | Sidebar navigation | - | ğŸ“ |
| #100 | Integration tests | - | ğŸ“ |

**Exit Criteria**: All features complete, ready for release

---

## ğŸ“Š Summary

### Issue Count by Epic

| Epic | Issues | Priority |
|------|--------|----------|
| E1: Database Foundation | 4 | P0 |
| E2: Shopping List | 7 | P1 |
| E3: Inventory Management | 5 | P1 |
| E4: AI Recommendations | 5 | P1 |
| E5: Integration & Polish | 5 | P2 |
| **Total** | **26** | |

### Issue Count by Type

| Type | Count |
|------|-------|
| Database | 3 |
| Frontend | 4 |
| Next.js API | 7 |
| Python API | 3 |
| Full-Stack | 4 |
| Testing | 5 |
| **Total** | **26** |

### Critical Path

```
#75 â†’ #76 â†’ #78 â†’ #79 â†’ #80 â†’ #82 â†’ #83 (Shopping List Complete)
       â†“
#77 â†’ #78 â†’ #86 â†’ #87 â†’ #88 â†’ #89 (Inventory Complete)
                    â†“
              #91 â†’ #92 â†’ #93 â†’ #94 (AI Complete)
                              â†“
                    #96 â†’ #97 â†’ #98 â†’ #100 (Integration Complete)
```

---

## ğŸš€ Next Steps

1. **Create GitHub Issues**: Use this plan to create issues #75-#100
2. **Set Milestone**: Add all issues to `v1.3.0-smart-cart` milestone
3. **Assign Sprint Labels**: Add `sprint-1`, `sprint-2`, etc.
4. **Begin Sprint 1**: Start with database schema issues
5. **Update 08-SPRINT-TASKS.md**: Track progress in main document

---

**Document maintained by**: Development Team  
**Last Updated**: November 29, 2025
